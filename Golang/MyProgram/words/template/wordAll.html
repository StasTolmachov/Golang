{{template "header"}}
<style>
    table {
        margin-left: auto;
        margin-right: auto;
        border-collapse: separate;
        border-spacing: 20px 0;
    }

    th,
    td {
        padding: 5px;
        text-align: center;
    }

    tr:hover {
        background-color: #f5f5f5;
    }
</style>
<main>
    <h1></h1>
    <h3>Elements: {{len .}}</h3>
    <table>
        <thead>
            <tr>

                <th>English</th>
                <th>Transcription</th>
                <th>Русское слово</th>
                <th>Rating</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td contenteditable="Rating" id="newEnglish"></td>
                <td contenteditable="Rating" id="newTranscription"></td>
                <td contenteditable="Rating" id="newRussian"></td>
                <td contenteditable="Rating" id="newRating">0</td>

                <td>
                    <button type="button" onclick="handleAddClick()">Add</button>
                </td>
            </tr>
            {{range $index, $element := .}}
            <tr>

                <td contenteditable="Rating" id="English{{$index}}"><a href="#"
                        onclick="handleEnglishClick({{$index}})">{{$element.English}}</a></td>

                <td contenteditable="Rating" id="Transcription{{$index}}">{{$element.Transcription}}</td>
                <td contenteditable="Rating" id="Russian{{$index}}">{{$element.Russian}}</td>
                <td contenteditable="Rating" id="Rating{{$index}}">{{$element.Rating}}</td>
                <td>
                    <button type="button" onclick="handleSaveClick({{$index}})" id="saveButton{{$index}}">Save</button>
                    <button type="button" onclick="handleDeleteClick({{$index}})">Delete</button>
                </td>
            </tr>
            {{end}}

        </tbody>
    </table>
</main>
{{template "footer"}}

<script>

    async function handleDeleteClick(index) {
        try {
            const response = await fetch('/handleIndex', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ index })
            });

            if (response.ok) {
                location.reload();
            } else {
                console.error('Ошибка при отправке запроса:', response.statusText);
            }
        } catch (error) {
            console.error('Ошибка при отправке запроса:', error);
        }
    }

    function handleSaveClick(index) {
        const English = document.getElementById("English" + index).innerText;
        const Transcription = document.getElementById("Transcription" + index).innerText;
        const Russian = document.getElementById("Russian" + index).innerText;
        const Rating = parseInt(document.getElementById("Rating" + index).innerText, 10);

        if (isNaN(Rating)) {
            alert("Рейтинг должен быть числом");
            return;
        }

        const requestData = {
            Index,
            English,
            Transcription,
            Russian,
            Rating,
        };

        fetch("/handleEdit", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify
                (requestData),
        })
            .then((response) => {
                if (response.ok) {
                    location.reload();
                } else {
                    console.error("Ошибка при отправке запроса:", response.statusText);
                }
            })
            .catch((error) => {
                console.error("Ошибка при отправке запроса:", error);
            });
    }
    function handleAddClick() {
        const English = document.getElementById("newEnglish").innerText;
        const Transcription = document.getElementById("newTranscription").innerText;
        const Russian = document.getElementById("newRussian").innerText;
        const Rating = parseInt(document.getElementById("newRating").innerText, 10);

        if (isNaN(Rating)) {
            alert("Рейтинг должен быть числом");
            return;
        }

        const requestData = {
            English,
            Transcription,
            Russian,
            Rating,
        };

        fetch("/handleAdd", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(requestData),
        })
            .then((response) => {
                if (response.ok) {
                    location.reload();
                } else {
                    console.error("Ошибка при отправке запроса:", response.statusText);
                }
            })
            .catch((error) => {
                console.error("Ошибка при отправке запроса:", error);
            });
    }
    function handleEnglishClick(index) {
        window.location.href = `/element-info/${index}`;
    }

</script>