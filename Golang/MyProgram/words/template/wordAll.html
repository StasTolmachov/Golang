{{template "header"}}
<style>
    table {
        margin-left: auto;
        margin-right: auto;
        border-collapse: separate;
        border-spacing: 3px 0;
        font-family: Arial, sans-serif;
        font-size: 14px;
        color: #333;
        width: 80%;
    }

    th,
    td {
        padding: 7px 5px;
        text-align: center;
        border: 1px solid #ddd;
    }

    tr:hover {
        background-color: #f5f5f5;
    }

    thead {
        background-color: #f2f2f2;
        font-weight: bold;
    }

    tbody tr:nth-child(odd) {
        background-color: #ffffff;
    }

    tbody tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    button {
        background-color: #4CAF50;
        color: white;
        padding: 1px 6px;
        margin: 6 6px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
    }

    button:hover {
        background-color: #45a049;
    }
</style>
<main>
    <h1></h1>
    <h3>Elements: {{len .}}</h3>
    <table>
        <thead>
            <tr>
                <th title="Action">Action</th>
                <th title="Original">Original</th>
                <th title="Transcription">Transcription</th>

                <th title="Past Simple Singular">PSS</th>
                <th title="Past Simple Singular Transcription">PSST</th>

                <th title="Past Simple Plural">PSP</th>
                <th title="Past Simple Plural Transcription">PSPT</th>

                <th title="Past Participle Singular">PPS</th>
                <th title="Past Participle Singular Transcription">PPST</th>

                <th title="Past Participle Plural">PPP</th>
                <th title="Past Participle Plural Transcription">PPPT</th>

                <th title="Translation">Translation</th>
                <th title="Synonyms">Synonyms</th>

                <th title="Rating">Rating</th>

            </tr>
        </thead>
        <tbody>

            {{range $index, $element := .}}
            <tr>
                <td>
                    <button type="button" onclick="handleSaveClick({{$index}})" id="saveButton{{$index}}">Save</button>
                    <button type="button" onclick="handleDeleteClick({{$index}})">Delete</button>
                </td>
                <td contenteditable="true" id="WordOriginal{{$index}}">{{$element.WordOriginal}}</td>
                <td contenteditable="true" id="WordOriginalTranscription{{$index}}">
                    {{$element.WordOriginalTranscription}}</td>

                <td contenteditable="true" id="WordOriginalPastSimpleSingular{{$index}}">
                    {{$element.WordOriginalPastSimpleSingular}}</td>
                <td contenteditable="true" id="WordOriginalPastSimpleSingularTranscription{{$index}}">
                    {{$element.WordOriginalPastSimpleSingularTranscription}}</td>

                <td contenteditable="true" id="WordOriginalPastSimplePlural{{$index}}">
                    {{$element.WordOriginalPastSimplePlural}}</td>
                <td contenteditable="true" id="WordOriginalPastSimplePluralTranscription{{$index}}">
                    {{$element.WordOriginalPastSimplePluralTranscription}}</td>

                <td contenteditable="true" id="WordOriginalPastParticipleSingular{{$index}}">
                    {{$element.WordOriginalPastParticipleSingular}}</td>
                <td contenteditable="true" id="WordOriginalPastParticipleSingularTranscription{{$index}}">
                    {{$element.WordOriginalPastParticipleSingularTranscription}}</td>

                <td contenteditable="true" id="WordOriginalPastParticiplePlural{{$index}}">
                    {{$element.WordOriginalPastParticiplePlural}}</td>
                <td contenteditable="true" id="WordOriginalPastParticiplePluralTranscription{{$index}}">
                    {{$element.WordOriginalPastParticiplePluralTranscription}}</td>


                <td contenteditable="true" id="WordTranslated{{$index}}">{{$element.WordTranslated}}</td>
                <td contenteditable="true" id="WordOriginalSynonyms{{$index}}">{{$element.WordOriginalSynonyms}}</td>

                </td>
                <td contenteditable="true" id="Rating{{$index}}">{{$element.Rating}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</main>
{{template "footer"}}

<script>

    function handleKeyDown(e) {
        // Проверяем, что клавиша Cmd (мета-клавиша) или Ctrl была нажата
        if (e.metaKey || e.ctrlKey) {
            // Проверяем, была ли нажата клавиша "1"
            if (e.key === '1') {
                callWordHandler();
            }
        }
    }

    function callWordHandler() {
        fetch('/word', {
            method: 'GET'
        })
            .then(response => response.text())
            .then(data => {
                console.log('Сервер ответил:', data);
            })
            .catch(error => {
                console.error('Ошибка запроса:', error);
            });
    }

    // Добавляем обработчик событий на нажатие клавиш
    document.addEventListener('keydown', handleKeyDown);

    async function handleDeleteClick(index) {
        try {
            const response = await fetch('/handleIndex', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ index })
            });

            if (response.ok) {
                location.reload();
            } else {
                console.error('Ошибка при отправке запроса:', response.statusText);
            }
        } catch (error) {
            console.error('Ошибка при отправке запроса:', error);
        }
    }

    function handleSaveClick(index) {
        const WordOriginal = document.getElementById("WordOriginal" + index).innerText;

        const WordOriginalPastSimpleSingular = document.getElementById("WordOriginalPastSimpleSingular" + index).innerText;
        const WordOriginalPastSimpleSingularTranscription = document.getElementById("WordOriginalPastSimpleSingularTranscription" + index).innerText;

        const WordOriginalPastSimplePlural = document.getElementById("WordOriginalPastSimplePlural" + index).innerText;
        const WordOriginalPastSimplePluralTranscription = document.getElementById("WordOriginalPastSimplePluralTranscription" + index).innerText;

        const WordOriginalPastParticipleSingular = document.getElementById("WordOriginalPastParticipleSingular" + index).innerText;
        const WordOriginalPastParticipleSingularTranscription = document.getElementById("WordOriginalPastParticipleSingularTranscription" + index).innerText;

        const WordOriginalPastParticiplePlural = document.getElementById("WordOriginalPastParticiplePlural" + index).innerText;
        const WordOriginalPastParticiplePluralTranscription = document.getElementById("WordOriginalPastParticiplePluralTranscription" + index).innerText;

        const WordOriginalTranscription = document.getElementById("WordOriginalTranscription" + index).innerText;
        const WordTranslated = document.getElementById("WordTranslated" + index).innerText;
        const WordOriginalSynonyms = document.getElementById("WordOriginalSynonyms" + index).innerText;

        const Rating = parseInt(document.getElementById("Rating" + index).innerText, 10);

        if (isNaN(Rating)) {
            alert("Рейтинг должен быть числом");
            return;
        }

        const requestData = {
            index,
            WordOriginal,

            WordOriginalPastSimpleSingular,
            WordOriginalPastSimplePlural,
            WordOriginalPastParticipleSingular,
            WordOriginalPastParticiplePlural,

            WordOriginalPastSimpleSingularTranscription,
            WordOriginalPastSimplePluralTranscription,
            WordOriginalPastParticipleSingularTranscription,
            WordOriginalPastParticiplePluralTranscription,

            WordOriginalTranscription,
            WordTranslated,
            WordOriginalSynonyms,

            Rating,
        };

        fetch("/handleEdit", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify
                (requestData),
        })
            .then((response) => {
                if (response.ok) {
                    location.reload();
                } else {
                    console.error("Ошибка при отправке запроса:", response.statusText);
                }
            })
            .catch((error) => {
                console.error("Ошибка при отправке запроса:", error);
            });
    }

</script>